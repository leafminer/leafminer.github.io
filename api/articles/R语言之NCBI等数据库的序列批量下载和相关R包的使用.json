{"title":"R语言之NCBI等数据库的序列批量下载和相关R包的使用","slug":"R语言之NCBI等数据库的序列批量下载和相关R包的使用","date":"2024-12-08T13:04:27.000Z","updated":"2024-12-08T13:13:36.130Z","comments":true,"path":"api/articles/R语言之NCBI等数据库的序列批量下载和相关R包的使用.json","excerpt":"Biomartr包报错信息问题1：​download.database.all(db = &quot;taxdb&quot;, path = &quot;taxdb&quot;)​运行后报错， 这个包检测网络连接情况的connected.to.internet​函数，源码如下:1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>connected.to.internet &lt;- function() &#123;<br>    if (curl::curl_fetch_memory(&quot;www.google.com&quot;)$status_code == 200) &#123;<br>        return(TRUE)<br>    &#125; else &#123;<br>        message(<br>            &quot;It seems that you are not connected to the internet. A query to www.google.com was not successful. Could you please check?&quot;<br>        )<br>    &#125;<br>&#125;<br>","covers":null,"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><div id=\"vip-container\"><h2 id=\"Biomartr包\">Biomartr包</h2>\n<h3 id=\"报错信息\">报错信息</h3>\n<h4 id=\"问题1：\">问题1：</h4>\n<p>​<code>download.database.all(db = &quot;taxdb&quot;, path = &quot;taxdb&quot;)</code>​运行后报错， 这个包检测网络连接情况的<code>connected.to.internet</code>​函数，源码如下:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">connected.to.internet &lt;- function() &#123;</span><br><span class=\"line\">    if (curl::curl_fetch_memory(&quot;www.google.com&quot;)$status_code == 200) &#123;</span><br><span class=\"line\">        return(TRUE)</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        message(</span><br><span class=\"line\">            &quot;It seems that you are not connected to the internet. A query to www.google.com was not successful. Could you please check?&quot;</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n<p>因为是检测google连接情况来判定网络是否联通的，所以国内使用会出问题。 解决办法： _ 修改hosts： _ 修改R包代码，把<code>www.google.com</code>​换成<code>www.bing.com</code>​，从github下载源码，修改后本地安装。</p>\n<h4 id=\"问题2（未解决）：\">问题2（未解决）：</h4>\n<p>​<code>getCollection( db = &quot;refseq&quot;, organism = &quot;Drosophila melanogaster&quot;)</code>​报错</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">The FTP link: <span class=\"string\">&#x27;https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/215/GCF_000001215.4_Release_6_plus_ISO1_MT/GCF_000001215.4_Release_6_plus_ISO1_MT_assembly_stats.txt&#x27;</span> seems <span class=\"keyword\">not</span> <span class=\"built_in\">to</span> be available <span class=\"keyword\">at</span> <span class=\"keyword\">the</span> moment. This might either be due <span class=\"built_in\">to</span> <span class=\"keyword\">an</span> instable <span class=\"keyword\">internet</span> connection, <span class=\"keyword\">a</span> firewall issue, <span class=\"keyword\">a</span> wrong organism name, <span class=\"keyword\">or</span> due <span class=\"built_in\">to</span> <span class=\"keyword\">the</span> fact that <span class=\"keyword\">the</span> specified organism is <span class=\"keyword\">not</span> available <span class=\"keyword\">in</span> <span class=\"keyword\">the</span> database you selected. If <span class=\"keyword\">it</span> is <span class=\"keyword\">an</span> <span class=\"keyword\">internet</span> connection issue, could you please <span class=\"keyword\">try</span> <span class=\"built_in\">to</span> re-run <span class=\"keyword\">the</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">to</span> <span class=\"title\">see</span> <span class=\"title\">whether</span> <span class=\"title\">it</span> <span class=\"title\">works</span> <span class=\"title\">now</span>?</span></span><br></pre></td></tr></table></figure>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mdHAubmNiaS5ubG0ubmloLmdvdi9nZW5vbWVzL2FsbC9HQ0YvMDAwLzAwMS8yMTUvR0NGXzAwMDAwMTIxNS40X1JlbGVhc2VfNl9wbHVzX0lTTzFfTVQvR0NGXzAwMDAwMTIxNS40X1JlbGVhc2VfNl9wbHVzX0lTTzFfTVRfYXNzZW1ibHlfc3RhdHMudHh0\">https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/215/GCF_000001215.4_Release_6_plus_ISO1_MT/GCF_000001215.4_Release_6_plus_ISO1_MT_assembly_stats.txt<i class=\"fa fa-external-link-alt\"></i></span>可以在浏览器中正常下载</p>\n<p>可能出问题的：<code>custom_download.R，getGenome.R，getBioSet.R，readAssemblyDoc.R，Refseq_Genbank_post_processing.R</code>​</p>\n<h3 id=\"简介\">简介</h3>\n<p>为了在元基因组规模上自动检索基因组和它们的注释信息，<code>biomartr</code>​包提供了基因组序列检索和功能注释检索的接口功能。<code>biomartr</code>​的主要目标是促进计算再现性和大规模处理基因组数据(元)基因组分析。有了<code>biomartr</code>​，用户现在可以控制并了解他们自动检索的基因组版本。许多大规模基因组学研究缺乏这些信息。当基因组版本信息的记录被忽视时，再现和数据解释几乎是不可能的。 In detail, <code>biomartr</code>​ automates <em>genome, proteome, CDS, RNA, Repeats, GFF/GTF (annotation), genome assembly quality, and metagenome project data</em> retrieval from the major biological databases such as <strong>NCBI RefSeq</strong> <strong>NCBI Genbank</strong> <strong>ENSEMBL</strong> <strong>ENSEMBLGENOMES</strong>(截止到2019年4月份 - ENSEMBL和ENSEMBLGENOMES已经合并了- see details here) <strong>UniProt</strong></p>\n<h3 id=\"安装biomartr包\">安装biomartr包</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># On Windows, this won&#x27;t work - see ?build_github_devtools</span><br><span class=\"line\">install_github(&quot;HajkD/biomartr&quot;, build_vignettes = TRUE, dependencies = TRUE)</span><br><span class=\"line\"></span><br><span class=\"line\"># When working with Windows, first you need to install the</span><br><span class=\"line\"># R package: rtools -&gt; install.packages(&quot;rtools&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># Afterwards you can install devtools -&gt; install.packages(&quot;devtools&quot;)</span><br><span class=\"line\"># and then you can run:</span><br><span class=\"line\"></span><br><span class=\"line\">devtools::install_github(&quot;HajkD/biomartr&quot;, build_vignettes = TRUE, dependencies = TRUE)</span><br><span class=\"line\"></span><br><span class=\"line\"># and then call it from the library</span><br><span class=\"line\">library(&quot;biomartr&quot;, lib.loc = &quot;C:/Program Files/R/R-3.1.1/library&quot;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"自带教程\">自带教程</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># source the biomartr package</span><br><span class=\"line\">library(biomartr)</span><br><span class=\"line\"># look for all tutorials (vignettes) available in the biomartr package</span><br><span class=\"line\"># this will open your web browser</span><br><span class=\"line\">browseVignettes(&quot;biomartr&quot;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"Meta-Genome-Retrieval\">Meta-Genome Retrieval</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/meta.retrieval.html\"><code>meta.retrieval()</code></a>​ : Perform Meta-Genome Retieval from NCBI of species belonging to the same kingdom of life or to the same taxonomic subgroup</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/meta.retrieval.all.html\"><code>meta.retrieval.all()</code></a>​ : Perform Meta-Genome Retieval from NCBI of the entire kingdom of life</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMetaGenomes.html\"><code>getMetaGenomes()</code></a>​ : Retrieve metagenomes from NCBI Genbank</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMetaGenomeAnnotations.html\"><code>getMetaGenomeAnnotations()</code></a>​ : Retrieve annotation *.gff files for metagenomes from NCBI Genbank</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listMetaGenomes.html\"><code>listMetaGenomes()</code></a>​ : List available metagenomes on NCBI Genbank</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMetaGenomeSummary.html\"><code>getMetaGenomeSummary()</code></a>​ : Helper function to retrieve the assembly_summary.txt file from NCBI genbank metagenomes</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<code>clean.retrieval()</code>​: Format meta.retrieval output</p>\n</li>\n</ul>\n<h4 id=\"Genome-Retrieval\">Genome Retrieval</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listGenomes.html\"><code>listGenomes()</code></a>​ : List all genomes available on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listKingdoms.html\"><code>listKingdoms()</code></a>​ : list the number of available species per kingdom of life on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listGroups.html\"><code>listGroups()</code></a>​ : list the number of available species per group on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getKingdoms.html\"><code>getKingdoms()</code></a>​ : Retrieve available kingdoms of life</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGroups.html\"><code>getGroups()</code></a>​ : Retrieve available groups for a kingdom of life</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/is.genome.available.html\"><code>is.genome.available()</code></a>​ : Check Genome Availability NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getCollection.html\"><code>getCollection()</code></a>​ : Retrieve a Collection: Genome, Proteome, CDS, RNA, GFF, Repeat Masker, AssemblyStats</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGenome.html\"><code>getGenome()</code></a>​ : Download a specific genome stored on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGenomeSet.html\"><code>getGenomeSet()</code></a>​ : Genome Retrieval of multiple species</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getProteome.html\"><code>getProteome()</code></a>​ : Download a specific proteome stored on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getProteomeSet.html\"><code>getProteomeSet()</code></a>​ : Proteome Retrieval of multiple species</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getCDS.html\"><code>getCDS()</code></a>​ : Download a specific CDS file (genome) stored on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getCDSSet.html\"><code>getCDSSet()</code></a>​ : CDS Retrieval of multiple species</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getRNA.html\"><code>getRNA()</code></a>​ : Download a specific RNA file stored on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getRNASet.html\"><code>getRNASet()</code></a>​ : RNA Retrieval of multiple species</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGFF.html\"><code>getGFF()</code></a>​ : Genome Annotation Retrieval from NCBI (<code>*.gff</code>​) and ENSEMBL (<code>*.gff3</code>​) servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGTF.html\"><code>getGTF()</code></a>​ : Genome Annotation Retrieval (<code>*.gtf</code>​) from ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<code>getRepeatMasker() :</code>​ Repeat Masker TE Annotation Retrieval</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getAssemblyStats.html\"><code>getAssemblyStats()</code></a>​ : Genome Assembly Stats Retrieval from NCBI</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getKingdomAssemblySummary.html\"><code>getKingdomAssemblySummary()</code></a>​ : Helper function to retrieve the assembly_summary.txt files from NCBI for all kingdoms</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMetaGenomeSummary.html\"><code>getMetaGenomeSummary()</code></a>​ : Helper function to retrieve the assembly_summary.txt files from NCBI genbank metagenomes</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getSummaryFile.html\"><code>getSummaryFile()</code></a>​ : Helper function to retrieve the assembly_summary.txt file from NCBI for a specific kingdom</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getENSEMBLInfo.html\"><code>getENSEMBLInfo()</code></a>​ : Retrieve ENSEMBL info file</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGENOMEREPORT.html\"><code>getGENOMEREPORT()</code></a>​ : Retrieve GENOME_REPORTS file from NCBI</p>\n</li>\n</ul>\n<h4 id=\"Import-Downloaded-Files\">Import Downloaded Files</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_genome.html\"><code>read\\_genome()</code></a>​ : Import genomes as Biostrings or data.table object</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_proteome.html\"><code>read\\_proteome()</code></a>​ : Import proteome as Biostrings or data.table object</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_cds.html\"><code>read\\_cds()</code></a>​ : Import CDS as Biostrings or data.table object</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_gff.html\"><code>read\\_gff()</code></a>​ : Import GFF file</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_rna.html\"><code>read\\_rna()</code></a>​ : Import RNA file</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_rm.html\"><code>read\\_rm()</code></a>​ : Import Repeat Masker output file</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_assemblystats.html\"><code>read\\_assemblystats()</code></a>​ : Import Genome Assembly Stats File</p>\n</li>\n</ul>\n<h4 id=\"Database-Retrieval\">Database Retrieval</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listDatabases.html\"><code>listNCBIDatabases()</code></a>​ : Retrieve a List of Available NCBI Databases for Download</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/download.database.html\"><code>download.database()</code></a>​ : Download a NCBI database to your local hard drive</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/download.database.all.html\"><code>download.database.all()</code></a>​ : Download a complete NCBI Database such as e.g. <code>NCBI nr</code>​ to your local hard drive</p>\n</li>\n</ul>\n<h4 id=\"BioMart-Queries\">BioMart Queries</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/biomart.html\"><code>biomart()</code></a>​ : Main function to query the BioMart database</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMarts.html\"><code>getMarts()</code></a>​ : Retrieve All Available BioMart Databases</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getDatasets.html\"><code>getDatasets()</code></a>​ : Retrieve All Available Datasets for a BioMart Database</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getAttributes.html\"><code>getAttributes()</code></a>​ : Retrieve All Available Attributes for a Specific Dataset</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getFilters.html\"><code>getFilters()</code></a>​ : Retrieve All Available Filters for a Specific Dataset</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/organismBM.html\"><code>organismBM()</code></a>​ : Function for organism specific retrieval of available BioMart marts and datasets</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/organismAttributes.html\"><code>organismAttributes()</code></a>​ : Function for organism specific retrieval of available BioMart attributes</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/organismFilters.html\"><code>organismFilters()</code></a>​ : Function for organism specific retrieval of available BioMart filters</p>\n</li>\n</ul>\n<h4 id=\"Performing-Gene-Ontology-queries\">Performing Gene Ontology queries</h4>\n<p><strong>Gene Ontology</strong></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGO.html\"><code>getGO()</code></a>​ : Function to retrieve GO terms for a given set of genes</p>\n</li>\n</ul>\n<h3 id=\"Ensembl-BioMart-Examples\">Ensembl BioMart Examples</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library(myTAI)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"示例\">示例</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># retrieve a list of available sequence databases at NCBI</span><br><span class=\"line\">listNCBIDatabases(db = &quot;all&quot;)</span><br><span class=\"line\"># show all NCBI nr files</span><br><span class=\"line\">listNCBIDatabases(db = &quot;nr&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># download the entire NCBI taxonomy database</span><br><span class=\"line\">download.database.all(db = &quot;taxdb&quot;, path = &quot;taxdb&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># download collection for Saccharomyces cerevisiae，用不了</span><br><span class=\"line\"># getCollection( db = &quot;refseq&quot;, organism = &quot;Drosophila melanogaster&quot;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># download all Drosophila melanogaster genomes,用不了</span><br><span class=\"line\"># meta.retrieval(kingdom = &quot;invertebrate&quot;, db = &quot;refseq&quot;, type = &quot;genome&quot;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"BiomaRt包和biomartr包的区别\">BiomaRt包和biomartr包的区别</h3>\n<p>BiomaRt软件包与biomartr软件包的主要区别在于，biomartr扩展了BiomaRt的功能注释检索过程，并提供了对基因组、蛋白质组、编码序列、gff文件、RNA序列、Repeat Masker注释文件的有用检索功能，以及对NCBI nr等整个数据库的检索功能。</p>\n<h2 id=\"BiomaRt包\">BiomaRt包</h2>\n<h3 id=\"报错信息-2\">报错信息</h3>\n<h4 id=\"问题1：-2\">问题1：</h4>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Error</span> <span class=\"keyword\">in</span> `collect<span class=\"literal\">()</span>`: ! <span class=\"type\">Failed</span> <span class=\"keyword\">to</span> collect <span class=\"keyword\">lazy</span> table. </span><br><span class=\"line\"><span class=\"type\">Caused</span> by error <span class=\"keyword\">in</span> `db_collect<span class=\"literal\">()</span>`: ! <span class=\"type\">Arguments</span> <span class=\"keyword\">in</span> `...` must be used. </span><br><span class=\"line\">✖ <span class=\"type\">Problematic</span> argument: • ..<span class=\"number\">1</span> = <span class=\"type\">Inf</span> ℹ <span class=\"type\">Did</span> you misspell an argument name? <span class=\"type\">Backtrace</span>:  </span><br><span class=\"line\"><span class=\"number\">1.</span> biomaRt::listEnsembl<span class=\"literal\">()</span>  </span><br><span class=\"line\"><span class=\"number\">11.</span> dbplyr:::collect.tbl_sql(., <span class=\"type\">Inf</span>)  </span><br><span class=\"line\"><span class=\"number\">16.</span> dbplyr::db_collect(x$src$con, sql, n = n, warn_incomplete = warn_incomplete, ...)</span><br></pre></td></tr></table></figure>\n<p>由于dplyr和Biocfilecache之间的不兼容导致的错误问题，而Biomart是无辜的旁观者！ <strong>解决办法</strong>：更新你的 BioManager 版本</p>\n<h4 id=\"问题2：\">问题2：</h4>\n<figure class=\"highlight oxygene\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">错误: Your query <span class=\"keyword\">has</span> been redirected <span class=\"keyword\">to</span> http:<span class=\"comment\">//status.ensembl.org indicating this Ensembl service is currently unavailable.</span></span><br><span class=\"line\">Look at ?useEnsembl <span class=\"keyword\">for</span> details <span class=\"keyword\">on</span> how <span class=\"keyword\">to</span> <span class=\"keyword\">try</span> a mirror site.</span><br></pre></td></tr></table></figure>\n<p>浏览器打不开该网站，等服务器好了就行了</p>\n<h3 id=\"简介-2\">简介</h3>\n<p>biomaRt工具包是一个连接bioMart数据库的R语言接口，能够通过这个软件包自由地链接到bioMart数据库： 1. 查找某个基因在染色体上的位置。反之，给定染色体每一区间，返回该区间的基因s； 2. 通过EntrezGene的ID查找到相关序列的GO注释。反之，给定相关的GO注释，获取相关的EntrezGene的ID； 3. 通过EntrezGene的ID查找到相关序列的上游100bp序列（可能包含启动子等调控元件）； 4. 查找人类染色体上每一段区域中已知的SNPs； 5. 给定一组的序列ID，获得其中具体的序列；</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library(biomaRt)</span><br></pre></td></tr></table></figure>\n<h3 id=\"选择数据库和对应的服务\">选择数据库和对应的服务</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 线虫数据库WormBase ParaSite host=&quot;parasite.wormbase.org&quot;</span><br></pre></td></tr></table></figure>\n<p>在ensembl.org网站上获取所有Ensembl mart的列表</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listEnsembl(mirror = &quot;asia&quot;)</span><br><span class=\"line\">#更换版本</span><br><span class=\"line\">listEnsembl(&quot;GRCh=37&quot;)</span><br></pre></td></tr></table></figure>\n<p>listMarts, listDatasets and useMart for the Ensembl mirrors You can connect to the following Ensembl mirrors using the listMarts, listDatasets and useMart functions:</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ensembl US West: <span class=\"exturl\" data-url=\"aHR0cHM6Ly91c3dlc3QuZW5zZW1ibC5vcmcvaW5kZXguaHRtbA==\">https://uswest.ensembl.org/index.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</li>\n<li class=\"lvl-2\">\n<p>Ensembl US East: <span class=\"exturl\" data-url=\"aHR0cHM6Ly91c2Vhc3QuZW5zZW1ibC5vcmcvaW5kZXguaHRtbA==\">https://useast.ensembl.org/index.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</li>\n<li class=\"lvl-2\">\n<p>Ensembl Asia: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hc2lhLmVuc2VtYmwub3JnL2luZGV4Lmh0bWw=\">https://asia.ensembl.org/index.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listMarts(host=&quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\"># 选取特定的服务</span><br><span class=\"line\">ensembl_asia &lt;- useMart(biomart=&quot;ENSEMBL_MART_ENSEMBL&quot;, host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\"># 同ensembl_asia1 &lt;- useMart(&quot;ensembl&quot;, host=&quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\"># 同ensembl_asia2 &lt;- useEnsembl(biomart=&quot;ensembl&quot;,host = &quot;http://asia.ensembl.org&quot;)</span><br><span class=\"line\"># useEnsembl函数专门用于ensembl数据库</span><br><span class=\"line\"></span><br><span class=\"line\">#查看可选数据集</span><br><span class=\"line\">head(listDatasets(ensembl_asia))</span><br><span class=\"line\"></span><br><span class=\"line\"># 限制为果蝇的基因注释数据集</span><br><span class=\"line\">dm_ensembl &lt;- useDataset(dataset=&quot;dmelanogaster_gene_ensembl&quot;, mart=ensembl_asia)</span><br><span class=\"line\"># 查看该数据集下的filters</span><br><span class=\"line\"># filter：控制根据什么东西来过滤，可以是不同数据库的ID，也可以是染色体定位系统坐标</span><br><span class=\"line\">filters &lt;- listFilters(dm_ensembl)</span><br><span class=\"line\"># 查看该数据集下的attributes</span><br><span class=\"line\">attrs &lt;- listAttributes(dm_ensembl)</span><br><span class=\"line\">table(attrs$page)</span><br></pre></td></tr></table></figure>\n<p>“<code>listDatasets</code>​” function will give you the list of all the species available (mart datasets) for a given mart <code>getBM</code>​允许使用mart过滤器和属性列表（filters和attributes）构建BioMart查询。</p>\n<h4 id=\"示例1：给定-EntrezGene，获取其5’-UTR序列\">示例1：给定 EntrezGene，获取其5’ UTR序列</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">entrez &lt;- c(&quot;39454&quot;,&quot;50253&quot;,&quot;32871&quot;)</span><br><span class=\"line\">utr5 &lt;- getBM(attributes=c(&#x27;entrezgene_id&#x27;,&#x27;5utr&#x27;), # 总共有55中序列类型，详见attrs数据框</span><br><span class=\"line\">              filters=&quot;entrezgene_id&quot;,</span><br><span class=\"line\">              values=entrez,</span><br><span class=\"line\">              mart=dm_ensembl)</span><br><span class=\"line\"># 方法2: 针对ensembl库的通过getBM获取序列的简化版</span><br><span class=\"line\">utr5-2 &lt;- getSequence(id=entrez,</span><br><span class=\"line\">                    type=&quot;entrezgene_id&quot;,</span><br><span class=\"line\">                    seqType=&#x27;5utr&#x27;,</span><br><span class=\"line\">                    mart=dm_ensembl)</span><br></pre></td></tr></table></figure>\n<h4 id=\"示例2：获取Ensembl-Gene-Transcript-IDs-and-Uniprot-Swissprot，其映射到果蝇Ensembl-Gene-ID-“FBgn0038539”\">示例2：获取Ensembl Gene, Transcript IDs and Uniprot Swissprot，其映射到果蝇Ensembl Gene ID “FBgn0038539”</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dm_swissprot &lt;- biomaRt::getBM(attributes=c(&#x27;external_synonym&#x27;,&#x27;ensembl_transcript_id&#x27;,&#x27;uniprotswissprot&#x27;,&#x27;genbank&#x27;),</span><br><span class=\"line\">                      filters = &#x27;external_synonym&#x27;, </span><br><span class=\"line\">                      values = Dm_Atgs$SYMBOL, </span><br><span class=\"line\">                      mart = dm_ensembl)</span><br><span class=\"line\">dm_swissprot</span><br></pre></td></tr></table></figure>\n<h4 id=\"示例3：获取某一染色体上某一段位置的SNPs\">示例3：获取某一染色体上某一段位置的SNPs</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">snpmart &lt;- useMart(biomart = &quot;ENSEMBL_MART_SNP&quot;, dataset=&quot;hsapiens_snp&quot;,host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\">snps &lt;- getBM(attributes = c(&#x27;refsnp_id&#x27;,&#x27;allele&#x27;,&#x27;chrom_start&#x27;,&#x27;chrom_strand&#x27;),</span><br><span class=\"line\">              filters = c(&#x27;chr_name&#x27;,&#x27;start&#x27;,&#x27;end&#x27;),</span><br><span class=\"line\">              values = list(8,148350,148612),</span><br><span class=\"line\">              mart = snpmart)</span><br></pre></td></tr></table></figure>\n<h4 id=\"示例4：-出错了-将果蝇基因映射到人的基因上\">示例4：(出错了)将果蝇基因映射到人的基因上</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dm_ensembl &lt;- useMart(&#x27;ensembl&#x27;,dataset=&quot;dmelanogaster_gene_ensembl&quot;,host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\">human &lt;- useMart(&#x27;ensembl&#x27;,dataset = &quot;hsapiens_gene_ensembl&quot;,host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\">mouse &lt;- useMart(&#x27;ensembl&#x27;,dataset = &quot;mmusculus_gene_ensembl&quot;,host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\">dm2h.g &lt;- getLDS(attributes = c(&quot;external_synonym&quot;),</span><br><span class=\"line\">                filters = &quot;external_synonym&quot;,</span><br><span class=\"line\">                values = Dm_Atg_genes_ID$SYMBOL,</span><br><span class=\"line\">                mart = dm_ensembl,</span><br><span class=\"line\">                attributesL = c(&quot;hgnc_symbol&quot;,&quot;chromosome_name&quot;,&quot;start_position&quot;),</span><br><span class=\"line\">                martL = human,</span><br><span class=\"line\">                uniqueRows = T)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"R语言批量爬取NCBI基因注释数据\">R语言批量爬取NCBI基因注释数据</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#library(RCurl) </span><br><span class=\"line\">#library(stringr)</span><br><span class=\"line\">#library(XML)</span><br><span class=\"line\">library(httr2)</span><br><span class=\"line\">library(rvest)</span><br><span class=\"line\">rm(list=ls())</span><br></pre></td></tr></table></figure>\n<h4 id=\"导入要爬取的基因列表：\">导入要爬取的基因列表：</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Dm_Atg_genes &lt;- read.table(&#x27;Dm_Atgs.txt&#x27;,stringsAsFactors = F)</span><br><span class=\"line\">names(Dm_Atg_genes) &lt;- &#x27;SYMBOL&#x27;</span><br><span class=\"line\">Dm_Atg_genes</span><br></pre></td></tr></table></figure>\n<p>NCBI对于基因页面的索引方式都是 <strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmppYW5zaHUuY29tLz90PWh0dHBzOi8vd3d3Lm5jYmkubmxtLm5paC5nb3YvZ2VuZS9FbnRyemU=\">https://www.ncbi.nlm.nih.gov/gene/Entrze<i class=\"fa fa-external-link-alt\"></i></span></strong> <strong>ID</strong> 的方式。</p>\n<h4 id=\"gene-symbos​转为entrze-ID​\"><code>gene symbos</code>​转为<code>entrze ID</code>​</h4>\n<p>使用<code>mget()</code>​函数获取</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library(&quot;org.Dm.eg.db&quot;)</span><br><span class=\"line\">AnnotationDbi::keytypes(org.Dm.eg.db)</span><br><span class=\"line\">mget(Dm_Atg_genes$SYMBOL, #需要转换的Symbol</span><br><span class=\"line\">    org.Dm.egSYMBOL2EG, # Symbol转EntrezID</span><br><span class=\"line\">    ifnotfound=NA)</span><br><span class=\"line\"></span><br><span class=\"line\"># EntrezID转Symbol</span><br><span class=\"line\">mget(Dm_Atg_genes_ID$ENTREZID, #需要转换的EntrezID</span><br><span class=\"line\">    org.Dm.egSYMBOL, #EntrezID转Symbol</span><br><span class=\"line\">    ifnotfound=NA)</span><br></pre></td></tr></table></figure>\n<p>需要将<code>gene symbos</code>​转为<code>entrze ID</code>​，这里使用<code>clusterProfiler</code>​包的<code>bitr</code>​函数进行转换：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用clusterProfiler将gene symbol转为entrze ID</span><br><span class=\"line\">library(clusterProfiler)</span><br><span class=\"line\">Dm_Atg_genes_ID &lt;- bitr(Dm_Atg_genes$SYMBOL, fromType=&quot;SYMBOL&quot;, toType=&quot;ENTREZID&quot;, OrgDb=&quot;org.Dm.eg.db&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># EntrezID转Symbol</span><br><span class=\"line\">bitr(Dm_Atg_genes_ID$ENTREZID, #需要转换的基因ID</span><br><span class=\"line\">     fromType = &quot;ENTREZID&quot;, #需要转换的类型</span><br><span class=\"line\">     toType = &quot;SYMBOL&quot;, #需要转换为的类型</span><br><span class=\"line\">     OrgDb = org.Dm.eg.db) #注释包</span><br></pre></td></tr></table></figure>\n<p>AnnotationDbi包的<code>mapIds</code>​函数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用AnnotationDbi将gene symbol转为entrze ID</span><br><span class=\"line\">mapIds(x = org.Dm.eg.db,#注释包</span><br><span class=\"line\">      keys = Dm_Atg_genes$SYMBOL, #需要转换的基因Symbol</span><br><span class=\"line\">      keytype = &quot;SYMBOL&quot;, #需要转换的类型</span><br><span class=\"line\">      column = &quot;ENTREZID&quot;) #需要转换为的类型</span><br><span class=\"line\"></span><br><span class=\"line\"># EntrezID转Symbol</span><br><span class=\"line\">mapIds(x = org.Dm.eg.db,#注释包</span><br><span class=\"line\">      keys = Dm_Atg_genes_ID$ENTREZID, #需要转换的基因ID</span><br><span class=\"line\">      keytype = &quot;ENTREZID&quot;, #需要转换的类型</span><br><span class=\"line\">      column = &quot;SYMBOL&quot;)  #需要转换为的类型</span><br><span class=\"line\"></span><br><span class=\"line\"># 与mapIds函数相比，该函数可同时将一种ID转换成多种类型的ID。</span><br><span class=\"line\">select(x = org.Dm.eg.db,keys = Dm_Atg_genes_ID$SYMBOL,columns = c(&quot;GENENAME&quot;,&quot;ENTREZID&quot;),keytype = &quot;SYMBOL&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># 将Gene Symbol转换为Gene Name，key为Akt，属于Gene Symbol，所以对应的keytype为SYMBOL</span><br><span class=\"line\">mapIds(x = org.Dm.eg.db,keys = &quot;Akt&quot;,column = &quot;GENENAME&quot;,keytype = &quot;SYMBOL&quot;)</span><br></pre></td></tr></table></figure>\n<p>BiomaRt用起来更加灵活，可以不同版本参考基因组ID转换，不同类型基因ID转换，甚至同基因跨物种同源基因转换</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用BiomaRt将gene symbol转为entrze ID</span><br><span class=\"line\">library(biomaRt)</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看可用数据库</span><br><span class=\"line\">listMarts()</span><br><span class=\"line\">listEnsembl()</span><br><span class=\"line\"></span><br><span class=\"line\"># 建立数据库链接，ensembl</span><br><span class=\"line\">mart&lt;-useMart(&quot;ensembl&quot;)</span><br><span class=\"line\"># 寻找目标数据库，对应的物种及参考基因组版本</span><br><span class=\"line\">dataset_list=as.data.frame(listDatasets(mart))</span><br><span class=\"line\"># 选择果蝇数据库，重新建立数据库链接</span><br><span class=\"line\">mart_dm=useMart(&quot;ensembl&quot;, &quot;dmelanogaster_gene_ensembl&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看可用的输入数据类型 </span><br><span class=\"line\">mart_dm_list &lt;- listFilters(mart_dm)</span><br><span class=\"line\">write.csv(mart_dm_list,&quot;mart_dm_list.csv&quot;)</span><br><span class=\"line\"># 查看可用的输出数据类型</span><br><span class=\"line\">listAttributes(mart_dm)</span><br><span class=\"line\"></span><br><span class=\"line\"># ID 转换，不局限于ID转换，还可检索其他信息</span><br><span class=\"line\">list_gene &lt;- getBM(attributes=c(&#x27;entrezgene_id&#x27;,&#x27;ensembl_gene_id&#x27;,&#x27;external_synonym&#x27;,&quot;go_id&quot;, &quot;flybase_gene_id&quot;, &quot;external_gene_name&quot;,&quot;flybasename_gene&quot;), </span><br><span class=\"line\">                   filters = &#x27;entrezgene_id&#x27;, </span><br><span class=\"line\">                   values = Dm_Atg_genes_ID$ENTREZID, </span><br><span class=\"line\">                   mart = mart_dm)</span><br><span class=\"line\"># gene symbol转为entrze ID</span><br><span class=\"line\">getBM(attributes=c(&#x27;entrezgene_id&#x27;,&#x27;ensembl_gene_id&#x27;,&#x27;external_synonym&#x27;,&quot;go_id&quot;, &quot;external_gene_name&quot;), </span><br><span class=\"line\">                   filters = &#x27;external_synonym&#x27;, </span><br><span class=\"line\">                   values = Dm_Atg_genes_ID$SYMBOL, </span><br><span class=\"line\">                   mart = mart_dm)</span><br><span class=\"line\"># 需要注意的是，ensembl id转换时存在三种情况</span><br><span class=\"line\"># 1. 一个ensembl_gene_id转换为多个entrezgene_id，</span><br><span class=\"line\"># 2. 一个ensembl_gene_id转换为多个gene symbol</span><br><span class=\"line\"># 3. 同时还有许多基因ID无法成功转换，标记为NA</span><br><span class=\"line\">a=list_gene[!duplicated(list_gene$ensembl_gene_id),]</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 网址数据框：</span><br><span class=\"line\">Dm_Atg_genes_ID$NCBI_url &lt;- paste(&quot;https://www.ncbi.nlm.nih.gov/gene/&quot;,Dm_Atg_genes_ID$ENTREZID,sep=&quot;&quot;)</span><br><span class=\"line\">head(Dm_Atg_genes_ID)</span><br></pre></td></tr></table></figure>\n<p>使用<code>XML</code>​包的<code>getNodeSet()</code>​函数需要两个参数，一个是根据URL获得的网页<code>XML document</code>​对象，另一个是要定位的节点(<code>xpath</code>​格式)。</p>\n<p>​<code>Xpath:</code>​</p>\n<p>//*[@id=“summaryDl”]/dd[1]/text()</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Official Symbol的xpath：//*[@id=&quot;summaryDl&quot;]/dd[1]/text()</span><br><span class=\"line\"># Official Full name：//*[@id=&quot;summaryDl&quot;]/dd[2]/text()</span><br><span class=\"line\"># Primary source：//*[@id=&quot;summaryDl&quot;]/dd[3]/a</span><br><span class=\"line\"># Locus tag：//*[@id=&quot;summaryDl&quot;]/dt[4]</span><br><span class=\"line\"># See related：//*[@id=&quot;summaryDl&quot;]/dd[5]/a</span><br><span class=\"line\"># Gene type：//*[@id=&quot;summaryDl&quot;]/dd[5]/text()</span><br><span class=\"line\"># Summary：//*[@id=&quot;summaryDl&quot;]/dd[10]/text()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 用于Rcurl</span><br><span class=\"line\"># 根据xpath获取节点内容：</span><br><span class=\"line\">#getNodesTxt &lt;- function(html_txt1,xpath_p)&#123;</span><br><span class=\"line\">#  els1 = getNodeSet(html_txt1, xpath_p)</span><br><span class=\"line\">#  # 获得Node的内容，并且去除空字符：</span><br><span class=\"line\">  els1_txt &lt;- sapply(els1,xmlValue)[!(sapply(els1,xmlValue)==&quot;&quot;)]</span><br><span class=\"line\">#  # 去除\\n：</span><br><span class=\"line\">#  str_replace_all(els1_txt,&quot;(\\\\n )+&quot;,&quot;&quot;)</span><br><span class=\"line\">#&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">## 处理节点格式，为character且长度为0的赋值为NA：</span><br><span class=\"line\">#dealNodeTxt &lt;- function(NodeTxt)&#123;</span><br><span class=\"line\">#  ifelse(is.character(NodeTxt)==T &amp;&amp; length(NodeTxt)!=0 , NodeTxt , NA)</span><br><span class=\"line\">#&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>当HTTP请求不包含用户代理字符串时，该网络服务器似乎返回403禁止错误。 默认情况下，<code>RCurl</code>​不传递用户代理。 您可以使用<code>useragent</code>​=参数设置一个。<code>httr2</code>​包比<code>RCurl</code>​更好一些，可以发出HTTP请求(并且它默认设置了一个用户代理字符串)。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#for(i in 1:nrow(Dm_Atg_genes_ID))&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">#  if(url.exists(Dm_Atg_genes_ID[1,&quot;NCBI_url&quot;],useragent=&quot;curl/5.2.0 Rcurl/1.98.1.14&quot;)) &#123;</span><br><span class=\"line\">#    cat(&quot;网址连接正常！\\t&quot;)</span><br><span class=\"line\">#  &#125; else &#123;cat(&quot;网址有误！停止运行！\\t&quot;);break&#125;</span><br><span class=\"line\">#  # 获得网页：</span><br><span class=\"line\">#  doc &lt;- getURL(Dm_Atg_genes_ID[i,&quot;NCBI_url&quot;],useragent=&quot;curl/5.2.0 Rcurl/1.98.1.14&quot;)</span><br><span class=\"line\">#  # 使用httr2获取页面</span><br><span class=\"line\">#  doc &lt;- resp_body_html(req_perform(request(Dm_Atg_genes_ID[i,&quot;NCBI_url&quot;])))</span><br><span class=\"line\">#  cat(&quot;成功获得网页！\\t&quot;)</span><br><span class=\"line\">#  # 获得网页内容</span><br><span class=\"line\">#  html_txt1 &lt;- htmlParse(doc, asText = TRUE)</span><br><span class=\"line\">  </span><br><span class=\"line\">#  # 获得Full Name:</span><br><span class=\"line\">#  Dm_Atg_genes_ID[i,&quot;FullName&quot;] &lt;- dealNodeTxt(getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]/dd[2]/text()&#x27;))</span><br><span class=\"line\">#  cat(&quot;写入基因\\t&quot;)</span><br><span class=\"line\">#  # 获得Gene ID:</span><br><span class=\"line\">#  Dm_Atg_genes_ID[i,&quot;Gene_ID&quot;] &lt;- str_replace_all(dealNodeTxt(getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]#/dd[3]/a&#x27;)),&quot;HGNC|:&quot;,&quot;&quot;)</span><br><span class=\"line\">#  cat(&quot;写入Gene_ID\\t&quot;)</span><br><span class=\"line\">#  # 获得Gene type:</span><br><span class=\"line\">#  Dm_Atg_genes_ID[i,&quot;GeneType&quot;] &lt;- dealNodeTxt(getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]/dd[5]/text()&#x27;))</span><br><span class=\"line\">#  cat(&quot;写入GeneType\\t&quot;)</span><br><span class=\"line\">#  # 获得summary：</span><br><span class=\"line\">#  Dm_Atg_genes_ID[i,&quot;Summary&quot;] &lt;- ifelse(length(getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]/dd[10]/text()&#x27;))!=0,getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]/dd[10]/text()&#x27;),NA)</span><br><span class=\"line\">#  cat(&quot;写入Summary\\n&quot;)</span><br><span class=\"line\">  </span><br><span class=\"line\">#  print(paste(&quot;完成第&quot;,i,&quot;个了！&quot;))</span><br><span class=\"line\"></span><br><span class=\"line\">#&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">#xlsx::write.xlsx(Dm_Atg_genes_ID,file = &#x27;Dm_Atg_genes_NCBI.xlsx&#x27;,sheetName = &quot;Dm_Atgs_NCBI&quot;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"rvest爬取数据\">rvest爬取数据</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">NCBI_gene_page &lt;- read_html(Dm_Atg_genes_ID[1,&quot;NCBI_url&quot;], encoding = &quot;UTF-8&quot;)</span><br><span class=\"line\">html_nodes(NCBI_gene_page,&quot;p.summary&quot;)</span><br><span class=\"line\">html_text()</span><br></pre></td></tr></table></figure>\n<h2 id=\"rentrez-获取-NCBI-数据库数据\">rentrez 获取 NCBI 数据库数据</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library(rentrez)</span><br><span class=\"line\"></span><br><span class=\"line\"># NCBI 默认有访问限制，未设置 api key 时限制 3 次每秒，设置后限制 10 次每秒。如果有，通过 set_entrez_key 函数设置。</span><br><span class=\"line\">#set_entrez_key(&quot;xxxxxx&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># 列举可用的数据库 </span><br><span class=\"line\">entrez_dbs()</span><br><span class=\"line\"># 查看某数据库总结 </span><br><span class=\"line\">entrez_db_summary(&quot;pubmed&quot;)</span><br><span class=\"line\"># 查看某数据库支持的搜索字段（fields）</span><br><span class=\"line\">entrez_db_searchable(&quot;pubmed&quot;)</span><br><span class=\"line\"># 函数 entrez_link 获取不同数据库的链接</span><br><span class=\"line\">entrez_db_links(&quot;pubmed&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 在pubmed中搜索黑腹果蝇，用 entrez_search 函数，字段用 [] 包含。</span><br><span class=\"line\">es &lt;- entrez_search(db = &quot;pubmed&quot;, term = &quot;Drosophila heart[titl] AND 2017:2024[PDAT]&quot;, retmax = 30)</span><br><span class=\"line\">es</span><br><span class=\"line\"># 相关文献的IDs</span><br><span class=\"line\">es$ids</span><br><span class=\"line\"></span><br><span class=\"line\"># entrez_link()可用于查找交叉引用的记录</span><br><span class=\"line\">el &lt;- entrez_link(id = 38237924, db = &quot;&quot;,dbfrom = &quot;pubmed&quot;) #Sources for the full text of the paper </span><br><span class=\"line\">el$links</span><br><span class=\"line\">entrez_link(id = 38237924, db = &quot;nuccore&quot;,dbfrom = &quot;pubmed&quot;)</span><br><span class=\"line\"># 函数 entrez_summary 取得条目总结信息，设置 always_return_list = TRUE 让函数就算一个请求也返回列表，防止在 apply 或循环时出现非预期行为。</span><br><span class=\"line\">es &lt;- entrez_summary(db = &quot;pubmed&quot;, id = &quot;38237924&quot;)</span><br><span class=\"line\"># 函数 extract_from_esummary 从返回的总结对象提取需要信息。</span><br><span class=\"line\">extract_from_esummary(es, &quot;title&quot;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"pubmed文献计量\">pubmed文献计量</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search_year &lt;- function(year, term)&#123;</span><br><span class=\"line\">    query &lt;- paste(term, &quot;AND (&quot;, year, &quot;[PDAT])&quot;)</span><br><span class=\"line\">    entrez_search(db=&quot;pubmed&quot;, term=query, retmax=0)$count</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">year &lt;- 2014:2024</span><br><span class=\"line\">papers &lt;- sapply(year, search_year, term=&quot;Drosophila heart[titl]&quot;, USE.NAMES=FALSE)</span><br><span class=\"line\">plot(year, papers, type=&#x27;b&#x27;, main=&quot;The Rise of the Drosophila heart&quot;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"核酸序列-fasta-文件下载\">核酸序列 fasta 文件下载</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 函数 entrez_fetch 获取条目完整信息，常用于下载数据，如选择 nucleotide 数据库并返回类型为 fasta 时可以下载对应 fasta信息，返回为字符串写入到文件，即完成了核酸序列 fasta 文件下载。</span><br><span class=\"line\">el &lt;- entrez_link(dbfrom = &quot;taxonomy&quot;, id = &quot;28285&quot;, db = &quot;nucleotide&quot;)</span><br><span class=\"line\">nu5 &lt;- el$links$taxonomy_nuccore[1:5]</span><br><span class=\"line\">nu5</span><br><span class=\"line\"></span><br><span class=\"line\">ef &lt;- entrez_fetch(db = &quot;nucleotide&quot;, id = nu5, rettype = &quot;fasta&quot;)</span><br><span class=\"line\">temp &lt;- tempfile()</span><br><span class=\"line\">write(ef, temp)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"下载果蝇atg8a蛋白的数据\">下载果蝇atg8a蛋白的数据</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">all_the_links &lt;- entrez_link(dbfrom=&#x27;gene&#x27;, id=32001, db=&#x27;all&#x27;)</span><br><span class=\"line\">all_the_links$links</span><br><span class=\"line\">all_the_links$links$gene_protein</span><br><span class=\"line\"></span><br><span class=\"line\">nuc_links &lt;- entrez_link(dbfrom=&#x27;gene&#x27;, id=32001, db=&#x27;protein&#x27;)</span><br><span class=\"line\">nuc_links</span><br><span class=\"line\">nuc_links$links</span><br><span class=\"line\">nuc_links$links$gene_protein_refseq</span><br><span class=\"line\">ef &lt;- entrez_fetch(db = &quot;protein&quot;, id = 24641085, rettype = &quot;fasta&quot;)</span><br><span class=\"line\">write(ef, &#x27;dm_pro_24641085.fasta&#x27;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\">参考</h2>\n<ol>\n<li class=\"lvl-3\">\n<p>Drost HG, Paszkowski J. <strong>Biomartr: genomic data retrieval with R</strong>. <em>Bioinformatics</em> (2017) 33(8): 1216-1217. <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hY2FkZW1pYy5vdXAuY29tL2Jpb2luZm9ybWF0aWNzL2FydGljbGUvZG9pLzEwLjEwOTMvYmlvaW5mb3JtYXRpY3MvYnR3ODIxLzI5MzE4MTYvQmlvbWFydHItZ2Vub21pYy1kYXRhLXJldHJpZXZhbC13aXRoLVI=\">doi:10.1093/bioinformatics/btw821IF: 5.8 Q1 <i class=\"fa fa-external-link-alt\"></i></span>.</p>\n</li>\n<li class=\"lvl-3\">\n<p>R语言批量爬取NCBI基因注释数据 - 简书 (<span class=\"exturl\" data-url=\"aHR0cDovL2ppYW5zaHUuY29t\">jianshu.com<i class=\"fa fa-external-link-alt\"></i></span>)</p>\n</li>\n<li class=\"lvl-3\">\n<p>关于r：Rcurl：如果url存在，则url.exists返回false | 码农家园 (<span class=\"exturl\" data-url=\"aHR0cDovL2NvZGVub25nLmNvbQ==\">codenong.com<i class=\"fa fa-external-link-alt\"></i></span>)</p>\n</li>\n<li class=\"lvl-3\">\n<p>R语言biomaRt工具包学习笔记 - 知乎 (<span class=\"exturl\" data-url=\"aHR0cDovL3poaWh1LmNvbQ==\">zhihu.com<i class=\"fa fa-external-link-alt\"></i></span>)</p>\n</li>\n<li class=\"lvl-3\">\n<p>BiomaRt 包进行基因ID转换_biomart包id转化方法-CSDN博客</p>\n</li>\n<li class=\"lvl-3\">\n<p>rentrez 获取 NCBI 数据库数据 - 简书 (<span class=\"exturl\" data-url=\"aHR0cDovL2ppYW5zaHUuY29t\">jianshu.com<i class=\"fa fa-external-link-alt\"></i></span>)</p>\n</li>\n</ol>\n</div>\n\n\t\t\t<script src=\"https://my.openwrite.cn/js/readmore.js\" type=\"text/javascript\"></script>\n\t\t\t<script>\n\t\t\tvar isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);\n\t\t\tif (!isMobile) {\n\t\t\t    var btw = new BTWPlugin();\n\t\t\t    btw.init({\n\t\t\t        \"id\": \"vip-container\",\n\t\t\t        \"blogId\": \"33502-1730425843713-524\",\n\t\t\t        \"name\": \"虫子的生存笔记\",\n\t\t\t        \"qrcode\": \"https://leaf-miner.pages.dev/image/%E5%85%AC%E4%BC%97%E5%8F%B7.png\",\n\t\t\t        \"keyword\": \"more\"\n\t\t\t    });\n\t\t\t}\n\t\t\t</script>\n\t\t","more":"<p>因为是检测google连接情况来判定网络是否联通的，所以国内使用会出问题。 解决办法： _ 修改hosts： _ 修改R包代码，把<code>www.google.com</code>​换成<code>www.bing.com</code>​，从github下载源码，修改后本地安装。</p>\n<h4 id=\"问题2（未解决）：\">问题2（未解决）：</h4>\n<p>​<code>getCollection( db = &quot;refseq&quot;, organism = &quot;Drosophila melanogaster&quot;)</code>​报错</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">The FTP link: <span class=\"string\">&#x27;https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/215/GCF_000001215.4_Release_6_plus_ISO1_MT/GCF_000001215.4_Release_6_plus_ISO1_MT_assembly_stats.txt&#x27;</span> seems <span class=\"keyword\">not</span> <span class=\"built_in\">to</span> be available <span class=\"keyword\">at</span> <span class=\"keyword\">the</span> moment. This might either be due <span class=\"built_in\">to</span> <span class=\"keyword\">an</span> instable <span class=\"keyword\">internet</span> connection, <span class=\"keyword\">a</span> firewall issue, <span class=\"keyword\">a</span> wrong organism name, <span class=\"keyword\">or</span> due <span class=\"built_in\">to</span> <span class=\"keyword\">the</span> fact that <span class=\"keyword\">the</span> specified organism is <span class=\"keyword\">not</span> available <span class=\"keyword\">in</span> <span class=\"keyword\">the</span> database you selected. If <span class=\"keyword\">it</span> is <span class=\"keyword\">an</span> <span class=\"keyword\">internet</span> connection issue, could you please <span class=\"keyword\">try</span> <span class=\"built_in\">to</span> re-run <span class=\"keyword\">the</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">to</span> <span class=\"title\">see</span> <span class=\"title\">whether</span> <span class=\"title\">it</span> <span class=\"title\">works</span> <span class=\"title\">now</span>?</span></span><br></pre></td></tr></table></figure>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mdHAubmNiaS5ubG0ubmloLmdvdi9nZW5vbWVzL2FsbC9HQ0YvMDAwLzAwMS8yMTUvR0NGXzAwMDAwMTIxNS40X1JlbGVhc2VfNl9wbHVzX0lTTzFfTVQvR0NGXzAwMDAwMTIxNS40X1JlbGVhc2VfNl9wbHVzX0lTTzFfTVRfYXNzZW1ibHlfc3RhdHMudHh0\">https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/215/GCF_000001215.4_Release_6_plus_ISO1_MT/GCF_000001215.4_Release_6_plus_ISO1_MT_assembly_stats.txt<i class=\"fa fa-external-link-alt\"></i></span>可以在浏览器中正常下载</p>\n<p>可能出问题的：<code>custom_download.R，getGenome.R，getBioSet.R，readAssemblyDoc.R，Refseq_Genbank_post_processing.R</code>​</p>\n<h3 id=\"简介\">简介</h3>\n<p>为了在元基因组规模上自动检索基因组和它们的注释信息，<code>biomartr</code>​包提供了基因组序列检索和功能注释检索的接口功能。<code>biomartr</code>​的主要目标是促进计算再现性和大规模处理基因组数据(元)基因组分析。有了<code>biomartr</code>​，用户现在可以控制并了解他们自动检索的基因组版本。许多大规模基因组学研究缺乏这些信息。当基因组版本信息的记录被忽视时，再现和数据解释几乎是不可能的。 In detail, <code>biomartr</code>​ automates <em>genome, proteome, CDS, RNA, Repeats, GFF/GTF (annotation), genome assembly quality, and metagenome project data</em> retrieval from the major biological databases such as <strong>NCBI RefSeq</strong> <strong>NCBI Genbank</strong> <strong>ENSEMBL</strong> <strong>ENSEMBLGENOMES</strong>(截止到2019年4月份 - ENSEMBL和ENSEMBLGENOMES已经合并了- see details here) <strong>UniProt</strong></p>\n<h3 id=\"安装biomartr包\">安装biomartr包</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># On Windows, this won&#x27;t work - see ?build_github_devtools</span><br><span class=\"line\">install_github(&quot;HajkD/biomartr&quot;, build_vignettes = TRUE, dependencies = TRUE)</span><br><span class=\"line\"></span><br><span class=\"line\"># When working with Windows, first you need to install the</span><br><span class=\"line\"># R package: rtools -&gt; install.packages(&quot;rtools&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># Afterwards you can install devtools -&gt; install.packages(&quot;devtools&quot;)</span><br><span class=\"line\"># and then you can run:</span><br><span class=\"line\"></span><br><span class=\"line\">devtools::install_github(&quot;HajkD/biomartr&quot;, build_vignettes = TRUE, dependencies = TRUE)</span><br><span class=\"line\"></span><br><span class=\"line\"># and then call it from the library</span><br><span class=\"line\">library(&quot;biomartr&quot;, lib.loc = &quot;C:/Program Files/R/R-3.1.1/library&quot;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"自带教程\">自带教程</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># source the biomartr package</span><br><span class=\"line\">library(biomartr)</span><br><span class=\"line\"># look for all tutorials (vignettes) available in the biomartr package</span><br><span class=\"line\"># this will open your web browser</span><br><span class=\"line\">browseVignettes(&quot;biomartr&quot;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"Meta-Genome-Retrieval\">Meta-Genome Retrieval</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/meta.retrieval.html\"><code>meta.retrieval()</code></a>​ : Perform Meta-Genome Retieval from NCBI of species belonging to the same kingdom of life or to the same taxonomic subgroup</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/meta.retrieval.all.html\"><code>meta.retrieval.all()</code></a>​ : Perform Meta-Genome Retieval from NCBI of the entire kingdom of life</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMetaGenomes.html\"><code>getMetaGenomes()</code></a>​ : Retrieve metagenomes from NCBI Genbank</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMetaGenomeAnnotations.html\"><code>getMetaGenomeAnnotations()</code></a>​ : Retrieve annotation *.gff files for metagenomes from NCBI Genbank</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listMetaGenomes.html\"><code>listMetaGenomes()</code></a>​ : List available metagenomes on NCBI Genbank</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMetaGenomeSummary.html\"><code>getMetaGenomeSummary()</code></a>​ : Helper function to retrieve the assembly_summary.txt file from NCBI genbank metagenomes</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<code>clean.retrieval()</code>​: Format meta.retrieval output</p>\n</li>\n</ul>\n<h4 id=\"Genome-Retrieval\">Genome Retrieval</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listGenomes.html\"><code>listGenomes()</code></a>​ : List all genomes available on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listKingdoms.html\"><code>listKingdoms()</code></a>​ : list the number of available species per kingdom of life on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listGroups.html\"><code>listGroups()</code></a>​ : list the number of available species per group on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getKingdoms.html\"><code>getKingdoms()</code></a>​ : Retrieve available kingdoms of life</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGroups.html\"><code>getGroups()</code></a>​ : Retrieve available groups for a kingdom of life</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/is.genome.available.html\"><code>is.genome.available()</code></a>​ : Check Genome Availability NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getCollection.html\"><code>getCollection()</code></a>​ : Retrieve a Collection: Genome, Proteome, CDS, RNA, GFF, Repeat Masker, AssemblyStats</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGenome.html\"><code>getGenome()</code></a>​ : Download a specific genome stored on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGenomeSet.html\"><code>getGenomeSet()</code></a>​ : Genome Retrieval of multiple species</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getProteome.html\"><code>getProteome()</code></a>​ : Download a specific proteome stored on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getProteomeSet.html\"><code>getProteomeSet()</code></a>​ : Proteome Retrieval of multiple species</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getCDS.html\"><code>getCDS()</code></a>​ : Download a specific CDS file (genome) stored on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getCDSSet.html\"><code>getCDSSet()</code></a>​ : CDS Retrieval of multiple species</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getRNA.html\"><code>getRNA()</code></a>​ : Download a specific RNA file stored on NCBI and ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getRNASet.html\"><code>getRNASet()</code></a>​ : RNA Retrieval of multiple species</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGFF.html\"><code>getGFF()</code></a>​ : Genome Annotation Retrieval from NCBI (<code>*.gff</code>​) and ENSEMBL (<code>*.gff3</code>​) servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGTF.html\"><code>getGTF()</code></a>​ : Genome Annotation Retrieval (<code>*.gtf</code>​) from ENSEMBL servers</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<code>getRepeatMasker() :</code>​ Repeat Masker TE Annotation Retrieval</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getAssemblyStats.html\"><code>getAssemblyStats()</code></a>​ : Genome Assembly Stats Retrieval from NCBI</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getKingdomAssemblySummary.html\"><code>getKingdomAssemblySummary()</code></a>​ : Helper function to retrieve the assembly_summary.txt files from NCBI for all kingdoms</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMetaGenomeSummary.html\"><code>getMetaGenomeSummary()</code></a>​ : Helper function to retrieve the assembly_summary.txt files from NCBI genbank metagenomes</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getSummaryFile.html\"><code>getSummaryFile()</code></a>​ : Helper function to retrieve the assembly_summary.txt file from NCBI for a specific kingdom</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getENSEMBLInfo.html\"><code>getENSEMBLInfo()</code></a>​ : Retrieve ENSEMBL info file</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGENOMEREPORT.html\"><code>getGENOMEREPORT()</code></a>​ : Retrieve GENOME_REPORTS file from NCBI</p>\n</li>\n</ul>\n<h4 id=\"Import-Downloaded-Files\">Import Downloaded Files</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_genome.html\"><code>read\\_genome()</code></a>​ : Import genomes as Biostrings or data.table object</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_proteome.html\"><code>read\\_proteome()</code></a>​ : Import proteome as Biostrings or data.table object</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_cds.html\"><code>read\\_cds()</code></a>​ : Import CDS as Biostrings or data.table object</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_gff.html\"><code>read\\_gff()</code></a>​ : Import GFF file</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_rna.html\"><code>read\\_rna()</code></a>​ : Import RNA file</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_rm.html\"><code>read\\_rm()</code></a>​ : Import Repeat Masker output file</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/read_assemblystats.html\"><code>read\\_assemblystats()</code></a>​ : Import Genome Assembly Stats File</p>\n</li>\n</ul>\n<h4 id=\"Database-Retrieval\">Database Retrieval</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/listDatabases.html\"><code>listNCBIDatabases()</code></a>​ : Retrieve a List of Available NCBI Databases for Download</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/download.database.html\"><code>download.database()</code></a>​ : Download a NCBI database to your local hard drive</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/download.database.all.html\"><code>download.database.all()</code></a>​ : Download a complete NCBI Database such as e.g. <code>NCBI nr</code>​ to your local hard drive</p>\n</li>\n</ul>\n<h4 id=\"BioMart-Queries\">BioMart Queries</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/biomart.html\"><code>biomart()</code></a>​ : Main function to query the BioMart database</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getMarts.html\"><code>getMarts()</code></a>​ : Retrieve All Available BioMart Databases</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getDatasets.html\"><code>getDatasets()</code></a>​ : Retrieve All Available Datasets for a BioMart Database</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getAttributes.html\"><code>getAttributes()</code></a>​ : Retrieve All Available Attributes for a Specific Dataset</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getFilters.html\"><code>getFilters()</code></a>​ : Retrieve All Available Filters for a Specific Dataset</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/organismBM.html\"><code>organismBM()</code></a>​ : Function for organism specific retrieval of available BioMart marts and datasets</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/organismAttributes.html\"><code>organismAttributes()</code></a>​ : Function for organism specific retrieval of available BioMart attributes</p>\n</li>\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/organismFilters.html\"><code>organismFilters()</code></a>​ : Function for organism specific retrieval of available BioMart filters</p>\n</li>\n</ul>\n<h4 id=\"Performing-Gene-Ontology-queries\">Performing Gene Ontology queries</h4>\n<p><strong>Gene Ontology</strong></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>​<a href=\"https://docs.ropensci.org/biomartr/reference/getGO.html\"><code>getGO()</code></a>​ : Function to retrieve GO terms for a given set of genes</p>\n</li>\n</ul>\n<h3 id=\"Ensembl-BioMart-Examples\">Ensembl BioMart Examples</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library(myTAI)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"示例\">示例</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># retrieve a list of available sequence databases at NCBI</span><br><span class=\"line\">listNCBIDatabases(db = &quot;all&quot;)</span><br><span class=\"line\"># show all NCBI nr files</span><br><span class=\"line\">listNCBIDatabases(db = &quot;nr&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># download the entire NCBI taxonomy database</span><br><span class=\"line\">download.database.all(db = &quot;taxdb&quot;, path = &quot;taxdb&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># download collection for Saccharomyces cerevisiae，用不了</span><br><span class=\"line\"># getCollection( db = &quot;refseq&quot;, organism = &quot;Drosophila melanogaster&quot;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># download all Drosophila melanogaster genomes,用不了</span><br><span class=\"line\"># meta.retrieval(kingdom = &quot;invertebrate&quot;, db = &quot;refseq&quot;, type = &quot;genome&quot;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"BiomaRt包和biomartr包的区别\">BiomaRt包和biomartr包的区别</h3>\n<p>BiomaRt软件包与biomartr软件包的主要区别在于，biomartr扩展了BiomaRt的功能注释检索过程，并提供了对基因组、蛋白质组、编码序列、gff文件、RNA序列、Repeat Masker注释文件的有用检索功能，以及对NCBI nr等整个数据库的检索功能。</p>\n<h2 id=\"BiomaRt包\">BiomaRt包</h2>\n<h3 id=\"报错信息-2\">报错信息</h3>\n<h4 id=\"问题1：-2\">问题1：</h4>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Error</span> <span class=\"keyword\">in</span> `collect<span class=\"literal\">()</span>`: ! <span class=\"type\">Failed</span> <span class=\"keyword\">to</span> collect <span class=\"keyword\">lazy</span> table. </span><br><span class=\"line\"><span class=\"type\">Caused</span> by error <span class=\"keyword\">in</span> `db_collect<span class=\"literal\">()</span>`: ! <span class=\"type\">Arguments</span> <span class=\"keyword\">in</span> `...` must be used. </span><br><span class=\"line\">✖ <span class=\"type\">Problematic</span> argument: • ..<span class=\"number\">1</span> = <span class=\"type\">Inf</span> ℹ <span class=\"type\">Did</span> you misspell an argument name? <span class=\"type\">Backtrace</span>:  </span><br><span class=\"line\"><span class=\"number\">1.</span> biomaRt::listEnsembl<span class=\"literal\">()</span>  </span><br><span class=\"line\"><span class=\"number\">11.</span> dbplyr:::collect.tbl_sql(., <span class=\"type\">Inf</span>)  </span><br><span class=\"line\"><span class=\"number\">16.</span> dbplyr::db_collect(x$src$con, sql, n = n, warn_incomplete = warn_incomplete, ...)</span><br></pre></td></tr></table></figure>\n<p>由于dplyr和Biocfilecache之间的不兼容导致的错误问题，而Biomart是无辜的旁观者！ <strong>解决办法</strong>：更新你的 BioManager 版本</p>\n<h4 id=\"问题2：\">问题2：</h4>\n<figure class=\"highlight oxygene\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">错误: Your query <span class=\"keyword\">has</span> been redirected <span class=\"keyword\">to</span> http:<span class=\"comment\">//status.ensembl.org indicating this Ensembl service is currently unavailable.</span></span><br><span class=\"line\">Look at ?useEnsembl <span class=\"keyword\">for</span> details <span class=\"keyword\">on</span> how <span class=\"keyword\">to</span> <span class=\"keyword\">try</span> a mirror site.</span><br></pre></td></tr></table></figure>\n<p>浏览器打不开该网站，等服务器好了就行了</p>\n<h3 id=\"简介-2\">简介</h3>\n<p>biomaRt工具包是一个连接bioMart数据库的R语言接口，能够通过这个软件包自由地链接到bioMart数据库： 1. 查找某个基因在染色体上的位置。反之，给定染色体每一区间，返回该区间的基因s； 2. 通过EntrezGene的ID查找到相关序列的GO注释。反之，给定相关的GO注释，获取相关的EntrezGene的ID； 3. 通过EntrezGene的ID查找到相关序列的上游100bp序列（可能包含启动子等调控元件）； 4. 查找人类染色体上每一段区域中已知的SNPs； 5. 给定一组的序列ID，获得其中具体的序列；</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library(biomaRt)</span><br></pre></td></tr></table></figure>\n<h3 id=\"选择数据库和对应的服务\">选择数据库和对应的服务</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 线虫数据库WormBase ParaSite host=&quot;parasite.wormbase.org&quot;</span><br></pre></td></tr></table></figure>\n<p>在ensembl.org网站上获取所有Ensembl mart的列表</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listEnsembl(mirror = &quot;asia&quot;)</span><br><span class=\"line\">#更换版本</span><br><span class=\"line\">listEnsembl(&quot;GRCh=37&quot;)</span><br></pre></td></tr></table></figure>\n<p>listMarts, listDatasets and useMart for the Ensembl mirrors You can connect to the following Ensembl mirrors using the listMarts, listDatasets and useMart functions:</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ensembl US West: <span class=\"exturl\" data-url=\"aHR0cHM6Ly91c3dlc3QuZW5zZW1ibC5vcmcvaW5kZXguaHRtbA==\">https://uswest.ensembl.org/index.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</li>\n<li class=\"lvl-2\">\n<p>Ensembl US East: <span class=\"exturl\" data-url=\"aHR0cHM6Ly91c2Vhc3QuZW5zZW1ibC5vcmcvaW5kZXguaHRtbA==\">https://useast.ensembl.org/index.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</li>\n<li class=\"lvl-2\">\n<p>Ensembl Asia: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hc2lhLmVuc2VtYmwub3JnL2luZGV4Lmh0bWw=\">https://asia.ensembl.org/index.html<i class=\"fa fa-external-link-alt\"></i></span></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listMarts(host=&quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\"># 选取特定的服务</span><br><span class=\"line\">ensembl_asia &lt;- useMart(biomart=&quot;ENSEMBL_MART_ENSEMBL&quot;, host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\"># 同ensembl_asia1 &lt;- useMart(&quot;ensembl&quot;, host=&quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\"># 同ensembl_asia2 &lt;- useEnsembl(biomart=&quot;ensembl&quot;,host = &quot;http://asia.ensembl.org&quot;)</span><br><span class=\"line\"># useEnsembl函数专门用于ensembl数据库</span><br><span class=\"line\"></span><br><span class=\"line\">#查看可选数据集</span><br><span class=\"line\">head(listDatasets(ensembl_asia))</span><br><span class=\"line\"></span><br><span class=\"line\"># 限制为果蝇的基因注释数据集</span><br><span class=\"line\">dm_ensembl &lt;- useDataset(dataset=&quot;dmelanogaster_gene_ensembl&quot;, mart=ensembl_asia)</span><br><span class=\"line\"># 查看该数据集下的filters</span><br><span class=\"line\"># filter：控制根据什么东西来过滤，可以是不同数据库的ID，也可以是染色体定位系统坐标</span><br><span class=\"line\">filters &lt;- listFilters(dm_ensembl)</span><br><span class=\"line\"># 查看该数据集下的attributes</span><br><span class=\"line\">attrs &lt;- listAttributes(dm_ensembl)</span><br><span class=\"line\">table(attrs$page)</span><br></pre></td></tr></table></figure>\n<p>“<code>listDatasets</code>​” function will give you the list of all the species available (mart datasets) for a given mart <code>getBM</code>​允许使用mart过滤器和属性列表（filters和attributes）构建BioMart查询。</p>\n<h4 id=\"示例1：给定-EntrezGene，获取其5’-UTR序列\">示例1：给定 EntrezGene，获取其5’ UTR序列</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">entrez &lt;- c(&quot;39454&quot;,&quot;50253&quot;,&quot;32871&quot;)</span><br><span class=\"line\">utr5 &lt;- getBM(attributes=c(&#x27;entrezgene_id&#x27;,&#x27;5utr&#x27;), # 总共有55中序列类型，详见attrs数据框</span><br><span class=\"line\">              filters=&quot;entrezgene_id&quot;,</span><br><span class=\"line\">              values=entrez,</span><br><span class=\"line\">              mart=dm_ensembl)</span><br><span class=\"line\"># 方法2: 针对ensembl库的通过getBM获取序列的简化版</span><br><span class=\"line\">utr5-2 &lt;- getSequence(id=entrez,</span><br><span class=\"line\">                    type=&quot;entrezgene_id&quot;,</span><br><span class=\"line\">                    seqType=&#x27;5utr&#x27;,</span><br><span class=\"line\">                    mart=dm_ensembl)</span><br></pre></td></tr></table></figure>\n<h4 id=\"示例2：获取Ensembl-Gene-Transcript-IDs-and-Uniprot-Swissprot，其映射到果蝇Ensembl-Gene-ID-“FBgn0038539”\">示例2：获取Ensembl Gene, Transcript IDs and Uniprot Swissprot，其映射到果蝇Ensembl Gene ID “FBgn0038539”</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dm_swissprot &lt;- biomaRt::getBM(attributes=c(&#x27;external_synonym&#x27;,&#x27;ensembl_transcript_id&#x27;,&#x27;uniprotswissprot&#x27;,&#x27;genbank&#x27;),</span><br><span class=\"line\">                      filters = &#x27;external_synonym&#x27;, </span><br><span class=\"line\">                      values = Dm_Atgs$SYMBOL, </span><br><span class=\"line\">                      mart = dm_ensembl)</span><br><span class=\"line\">dm_swissprot</span><br></pre></td></tr></table></figure>\n<h4 id=\"示例3：获取某一染色体上某一段位置的SNPs\">示例3：获取某一染色体上某一段位置的SNPs</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">snpmart &lt;- useMart(biomart = &quot;ENSEMBL_MART_SNP&quot;, dataset=&quot;hsapiens_snp&quot;,host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\">snps &lt;- getBM(attributes = c(&#x27;refsnp_id&#x27;,&#x27;allele&#x27;,&#x27;chrom_start&#x27;,&#x27;chrom_strand&#x27;),</span><br><span class=\"line\">              filters = c(&#x27;chr_name&#x27;,&#x27;start&#x27;,&#x27;end&#x27;),</span><br><span class=\"line\">              values = list(8,148350,148612),</span><br><span class=\"line\">              mart = snpmart)</span><br></pre></td></tr></table></figure>\n<h4 id=\"示例4：-出错了-将果蝇基因映射到人的基因上\">示例4：(出错了)将果蝇基因映射到人的基因上</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dm_ensembl &lt;- useMart(&#x27;ensembl&#x27;,dataset=&quot;dmelanogaster_gene_ensembl&quot;,host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\">human &lt;- useMart(&#x27;ensembl&#x27;,dataset = &quot;hsapiens_gene_ensembl&quot;,host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\">mouse &lt;- useMart(&#x27;ensembl&#x27;,dataset = &quot;mmusculus_gene_ensembl&quot;,host = &quot;https://asia.ensembl.org&quot;)</span><br><span class=\"line\">dm2h.g &lt;- getLDS(attributes = c(&quot;external_synonym&quot;),</span><br><span class=\"line\">                filters = &quot;external_synonym&quot;,</span><br><span class=\"line\">                values = Dm_Atg_genes_ID$SYMBOL,</span><br><span class=\"line\">                mart = dm_ensembl,</span><br><span class=\"line\">                attributesL = c(&quot;hgnc_symbol&quot;,&quot;chromosome_name&quot;,&quot;start_position&quot;),</span><br><span class=\"line\">                martL = human,</span><br><span class=\"line\">                uniqueRows = T)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"R语言批量爬取NCBI基因注释数据\">R语言批量爬取NCBI基因注释数据</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#library(RCurl) </span><br><span class=\"line\">#library(stringr)</span><br><span class=\"line\">#library(XML)</span><br><span class=\"line\">library(httr2)</span><br><span class=\"line\">library(rvest)</span><br><span class=\"line\">rm(list=ls())</span><br></pre></td></tr></table></figure>\n<h4 id=\"导入要爬取的基因列表：\">导入要爬取的基因列表：</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Dm_Atg_genes &lt;- read.table(&#x27;Dm_Atgs.txt&#x27;,stringsAsFactors = F)</span><br><span class=\"line\">names(Dm_Atg_genes) &lt;- &#x27;SYMBOL&#x27;</span><br><span class=\"line\">Dm_Atg_genes</span><br></pre></td></tr></table></figure>\n<p>NCBI对于基因页面的索引方式都是 <strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmppYW5zaHUuY29tLz90PWh0dHBzOi8vd3d3Lm5jYmkubmxtLm5paC5nb3YvZ2VuZS9FbnRyemU=\">https://www.ncbi.nlm.nih.gov/gene/Entrze<i class=\"fa fa-external-link-alt\"></i></span></strong> <strong>ID</strong> 的方式。</p>\n<h4 id=\"gene-symbos​转为entrze-ID​\"><code>gene symbos</code>​转为<code>entrze ID</code>​</h4>\n<p>使用<code>mget()</code>​函数获取</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library(&quot;org.Dm.eg.db&quot;)</span><br><span class=\"line\">AnnotationDbi::keytypes(org.Dm.eg.db)</span><br><span class=\"line\">mget(Dm_Atg_genes$SYMBOL, #需要转换的Symbol</span><br><span class=\"line\">    org.Dm.egSYMBOL2EG, # Symbol转EntrezID</span><br><span class=\"line\">    ifnotfound=NA)</span><br><span class=\"line\"></span><br><span class=\"line\"># EntrezID转Symbol</span><br><span class=\"line\">mget(Dm_Atg_genes_ID$ENTREZID, #需要转换的EntrezID</span><br><span class=\"line\">    org.Dm.egSYMBOL, #EntrezID转Symbol</span><br><span class=\"line\">    ifnotfound=NA)</span><br></pre></td></tr></table></figure>\n<p>需要将<code>gene symbos</code>​转为<code>entrze ID</code>​，这里使用<code>clusterProfiler</code>​包的<code>bitr</code>​函数进行转换：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用clusterProfiler将gene symbol转为entrze ID</span><br><span class=\"line\">library(clusterProfiler)</span><br><span class=\"line\">Dm_Atg_genes_ID &lt;- bitr(Dm_Atg_genes$SYMBOL, fromType=&quot;SYMBOL&quot;, toType=&quot;ENTREZID&quot;, OrgDb=&quot;org.Dm.eg.db&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># EntrezID转Symbol</span><br><span class=\"line\">bitr(Dm_Atg_genes_ID$ENTREZID, #需要转换的基因ID</span><br><span class=\"line\">     fromType = &quot;ENTREZID&quot;, #需要转换的类型</span><br><span class=\"line\">     toType = &quot;SYMBOL&quot;, #需要转换为的类型</span><br><span class=\"line\">     OrgDb = org.Dm.eg.db) #注释包</span><br></pre></td></tr></table></figure>\n<p>AnnotationDbi包的<code>mapIds</code>​函数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用AnnotationDbi将gene symbol转为entrze ID</span><br><span class=\"line\">mapIds(x = org.Dm.eg.db,#注释包</span><br><span class=\"line\">      keys = Dm_Atg_genes$SYMBOL, #需要转换的基因Symbol</span><br><span class=\"line\">      keytype = &quot;SYMBOL&quot;, #需要转换的类型</span><br><span class=\"line\">      column = &quot;ENTREZID&quot;) #需要转换为的类型</span><br><span class=\"line\"></span><br><span class=\"line\"># EntrezID转Symbol</span><br><span class=\"line\">mapIds(x = org.Dm.eg.db,#注释包</span><br><span class=\"line\">      keys = Dm_Atg_genes_ID$ENTREZID, #需要转换的基因ID</span><br><span class=\"line\">      keytype = &quot;ENTREZID&quot;, #需要转换的类型</span><br><span class=\"line\">      column = &quot;SYMBOL&quot;)  #需要转换为的类型</span><br><span class=\"line\"></span><br><span class=\"line\"># 与mapIds函数相比，该函数可同时将一种ID转换成多种类型的ID。</span><br><span class=\"line\">select(x = org.Dm.eg.db,keys = Dm_Atg_genes_ID$SYMBOL,columns = c(&quot;GENENAME&quot;,&quot;ENTREZID&quot;),keytype = &quot;SYMBOL&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># 将Gene Symbol转换为Gene Name，key为Akt，属于Gene Symbol，所以对应的keytype为SYMBOL</span><br><span class=\"line\">mapIds(x = org.Dm.eg.db,keys = &quot;Akt&quot;,column = &quot;GENENAME&quot;,keytype = &quot;SYMBOL&quot;)</span><br></pre></td></tr></table></figure>\n<p>BiomaRt用起来更加灵活，可以不同版本参考基因组ID转换，不同类型基因ID转换，甚至同基因跨物种同源基因转换</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 使用BiomaRt将gene symbol转为entrze ID</span><br><span class=\"line\">library(biomaRt)</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看可用数据库</span><br><span class=\"line\">listMarts()</span><br><span class=\"line\">listEnsembl()</span><br><span class=\"line\"></span><br><span class=\"line\"># 建立数据库链接，ensembl</span><br><span class=\"line\">mart&lt;-useMart(&quot;ensembl&quot;)</span><br><span class=\"line\"># 寻找目标数据库，对应的物种及参考基因组版本</span><br><span class=\"line\">dataset_list=as.data.frame(listDatasets(mart))</span><br><span class=\"line\"># 选择果蝇数据库，重新建立数据库链接</span><br><span class=\"line\">mart_dm=useMart(&quot;ensembl&quot;, &quot;dmelanogaster_gene_ensembl&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看可用的输入数据类型 </span><br><span class=\"line\">mart_dm_list &lt;- listFilters(mart_dm)</span><br><span class=\"line\">write.csv(mart_dm_list,&quot;mart_dm_list.csv&quot;)</span><br><span class=\"line\"># 查看可用的输出数据类型</span><br><span class=\"line\">listAttributes(mart_dm)</span><br><span class=\"line\"></span><br><span class=\"line\"># ID 转换，不局限于ID转换，还可检索其他信息</span><br><span class=\"line\">list_gene &lt;- getBM(attributes=c(&#x27;entrezgene_id&#x27;,&#x27;ensembl_gene_id&#x27;,&#x27;external_synonym&#x27;,&quot;go_id&quot;, &quot;flybase_gene_id&quot;, &quot;external_gene_name&quot;,&quot;flybasename_gene&quot;), </span><br><span class=\"line\">                   filters = &#x27;entrezgene_id&#x27;, </span><br><span class=\"line\">                   values = Dm_Atg_genes_ID$ENTREZID, </span><br><span class=\"line\">                   mart = mart_dm)</span><br><span class=\"line\"># gene symbol转为entrze ID</span><br><span class=\"line\">getBM(attributes=c(&#x27;entrezgene_id&#x27;,&#x27;ensembl_gene_id&#x27;,&#x27;external_synonym&#x27;,&quot;go_id&quot;, &quot;external_gene_name&quot;), </span><br><span class=\"line\">                   filters = &#x27;external_synonym&#x27;, </span><br><span class=\"line\">                   values = Dm_Atg_genes_ID$SYMBOL, </span><br><span class=\"line\">                   mart = mart_dm)</span><br><span class=\"line\"># 需要注意的是，ensembl id转换时存在三种情况</span><br><span class=\"line\"># 1. 一个ensembl_gene_id转换为多个entrezgene_id，</span><br><span class=\"line\"># 2. 一个ensembl_gene_id转换为多个gene symbol</span><br><span class=\"line\"># 3. 同时还有许多基因ID无法成功转换，标记为NA</span><br><span class=\"line\">a=list_gene[!duplicated(list_gene$ensembl_gene_id),]</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 网址数据框：</span><br><span class=\"line\">Dm_Atg_genes_ID$NCBI_url &lt;- paste(&quot;https://www.ncbi.nlm.nih.gov/gene/&quot;,Dm_Atg_genes_ID$ENTREZID,sep=&quot;&quot;)</span><br><span class=\"line\">head(Dm_Atg_genes_ID)</span><br></pre></td></tr></table></figure>\n<p>使用<code>XML</code>​包的<code>getNodeSet()</code>​函数需要两个参数，一个是根据URL获得的网页<code>XML document</code>​对象，另一个是要定位的节点(<code>xpath</code>​格式)。</p>\n<p>​<code>Xpath:</code>​</p>\n<p>//*[@id=“summaryDl”]/dd[1]/text()</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Official Symbol的xpath：//*[@id=&quot;summaryDl&quot;]/dd[1]/text()</span><br><span class=\"line\"># Official Full name：//*[@id=&quot;summaryDl&quot;]/dd[2]/text()</span><br><span class=\"line\"># Primary source：//*[@id=&quot;summaryDl&quot;]/dd[3]/a</span><br><span class=\"line\"># Locus tag：//*[@id=&quot;summaryDl&quot;]/dt[4]</span><br><span class=\"line\"># See related：//*[@id=&quot;summaryDl&quot;]/dd[5]/a</span><br><span class=\"line\"># Gene type：//*[@id=&quot;summaryDl&quot;]/dd[5]/text()</span><br><span class=\"line\"># Summary：//*[@id=&quot;summaryDl&quot;]/dd[10]/text()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 用于Rcurl</span><br><span class=\"line\"># 根据xpath获取节点内容：</span><br><span class=\"line\">#getNodesTxt &lt;- function(html_txt1,xpath_p)&#123;</span><br><span class=\"line\">#  els1 = getNodeSet(html_txt1, xpath_p)</span><br><span class=\"line\">#  # 获得Node的内容，并且去除空字符：</span><br><span class=\"line\">  els1_txt &lt;- sapply(els1,xmlValue)[!(sapply(els1,xmlValue)==&quot;&quot;)]</span><br><span class=\"line\">#  # 去除\\n：</span><br><span class=\"line\">#  str_replace_all(els1_txt,&quot;(\\\\n )+&quot;,&quot;&quot;)</span><br><span class=\"line\">#&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">## 处理节点格式，为character且长度为0的赋值为NA：</span><br><span class=\"line\">#dealNodeTxt &lt;- function(NodeTxt)&#123;</span><br><span class=\"line\">#  ifelse(is.character(NodeTxt)==T &amp;&amp; length(NodeTxt)!=0 , NodeTxt , NA)</span><br><span class=\"line\">#&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>当HTTP请求不包含用户代理字符串时，该网络服务器似乎返回403禁止错误。 默认情况下，<code>RCurl</code>​不传递用户代理。 您可以使用<code>useragent</code>​=参数设置一个。<code>httr2</code>​包比<code>RCurl</code>​更好一些，可以发出HTTP请求(并且它默认设置了一个用户代理字符串)。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#for(i in 1:nrow(Dm_Atg_genes_ID))&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">#  if(url.exists(Dm_Atg_genes_ID[1,&quot;NCBI_url&quot;],useragent=&quot;curl/5.2.0 Rcurl/1.98.1.14&quot;)) &#123;</span><br><span class=\"line\">#    cat(&quot;网址连接正常！\\t&quot;)</span><br><span class=\"line\">#  &#125; else &#123;cat(&quot;网址有误！停止运行！\\t&quot;);break&#125;</span><br><span class=\"line\">#  # 获得网页：</span><br><span class=\"line\">#  doc &lt;- getURL(Dm_Atg_genes_ID[i,&quot;NCBI_url&quot;],useragent=&quot;curl/5.2.0 Rcurl/1.98.1.14&quot;)</span><br><span class=\"line\">#  # 使用httr2获取页面</span><br><span class=\"line\">#  doc &lt;- resp_body_html(req_perform(request(Dm_Atg_genes_ID[i,&quot;NCBI_url&quot;])))</span><br><span class=\"line\">#  cat(&quot;成功获得网页！\\t&quot;)</span><br><span class=\"line\">#  # 获得网页内容</span><br><span class=\"line\">#  html_txt1 &lt;- htmlParse(doc, asText = TRUE)</span><br><span class=\"line\">  </span><br><span class=\"line\">#  # 获得Full Name:</span><br><span class=\"line\">#  Dm_Atg_genes_ID[i,&quot;FullName&quot;] &lt;- dealNodeTxt(getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]/dd[2]/text()&#x27;))</span><br><span class=\"line\">#  cat(&quot;写入基因\\t&quot;)</span><br><span class=\"line\">#  # 获得Gene ID:</span><br><span class=\"line\">#  Dm_Atg_genes_ID[i,&quot;Gene_ID&quot;] &lt;- str_replace_all(dealNodeTxt(getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]#/dd[3]/a&#x27;)),&quot;HGNC|:&quot;,&quot;&quot;)</span><br><span class=\"line\">#  cat(&quot;写入Gene_ID\\t&quot;)</span><br><span class=\"line\">#  # 获得Gene type:</span><br><span class=\"line\">#  Dm_Atg_genes_ID[i,&quot;GeneType&quot;] &lt;- dealNodeTxt(getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]/dd[5]/text()&#x27;))</span><br><span class=\"line\">#  cat(&quot;写入GeneType\\t&quot;)</span><br><span class=\"line\">#  # 获得summary：</span><br><span class=\"line\">#  Dm_Atg_genes_ID[i,&quot;Summary&quot;] &lt;- ifelse(length(getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]/dd[10]/text()&#x27;))!=0,getNodesTxt(html_txt1,&#x27;//*[@id=&quot;summaryDl&quot;]/dd[10]/text()&#x27;),NA)</span><br><span class=\"line\">#  cat(&quot;写入Summary\\n&quot;)</span><br><span class=\"line\">  </span><br><span class=\"line\">#  print(paste(&quot;完成第&quot;,i,&quot;个了！&quot;))</span><br><span class=\"line\"></span><br><span class=\"line\">#&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">#xlsx::write.xlsx(Dm_Atg_genes_ID,file = &#x27;Dm_Atg_genes_NCBI.xlsx&#x27;,sheetName = &quot;Dm_Atgs_NCBI&quot;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"rvest爬取数据\">rvest爬取数据</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">NCBI_gene_page &lt;- read_html(Dm_Atg_genes_ID[1,&quot;NCBI_url&quot;], encoding = &quot;UTF-8&quot;)</span><br><span class=\"line\">html_nodes(NCBI_gene_page,&quot;p.summary&quot;)</span><br><span class=\"line\">html_text()</span><br></pre></td></tr></table></figure>\n<h2 id=\"rentrez-获取-NCBI-数据库数据\">rentrez 获取 NCBI 数据库数据</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library(rentrez)</span><br><span class=\"line\"></span><br><span class=\"line\"># NCBI 默认有访问限制，未设置 api key 时限制 3 次每秒，设置后限制 10 次每秒。如果有，通过 set_entrez_key 函数设置。</span><br><span class=\"line\">#set_entrez_key(&quot;xxxxxx&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># 列举可用的数据库 </span><br><span class=\"line\">entrez_dbs()</span><br><span class=\"line\"># 查看某数据库总结 </span><br><span class=\"line\">entrez_db_summary(&quot;pubmed&quot;)</span><br><span class=\"line\"># 查看某数据库支持的搜索字段（fields）</span><br><span class=\"line\">entrez_db_searchable(&quot;pubmed&quot;)</span><br><span class=\"line\"># 函数 entrez_link 获取不同数据库的链接</span><br><span class=\"line\">entrez_db_links(&quot;pubmed&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 在pubmed中搜索黑腹果蝇，用 entrez_search 函数，字段用 [] 包含。</span><br><span class=\"line\">es &lt;- entrez_search(db = &quot;pubmed&quot;, term = &quot;Drosophila heart[titl] AND 2017:2024[PDAT]&quot;, retmax = 30)</span><br><span class=\"line\">es</span><br><span class=\"line\"># 相关文献的IDs</span><br><span class=\"line\">es$ids</span><br><span class=\"line\"></span><br><span class=\"line\"># entrez_link()可用于查找交叉引用的记录</span><br><span class=\"line\">el &lt;- entrez_link(id = 38237924, db = &quot;&quot;,dbfrom = &quot;pubmed&quot;) #Sources for the full text of the paper </span><br><span class=\"line\">el$links</span><br><span class=\"line\">entrez_link(id = 38237924, db = &quot;nuccore&quot;,dbfrom = &quot;pubmed&quot;)</span><br><span class=\"line\"># 函数 entrez_summary 取得条目总结信息，设置 always_return_list = TRUE 让函数就算一个请求也返回列表，防止在 apply 或循环时出现非预期行为。</span><br><span class=\"line\">es &lt;- entrez_summary(db = &quot;pubmed&quot;, id = &quot;38237924&quot;)</span><br><span class=\"line\"># 函数 extract_from_esummary 从返回的总结对象提取需要信息。</span><br><span class=\"line\">extract_from_esummary(es, &quot;title&quot;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"pubmed文献计量\">pubmed文献计量</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search_year &lt;- function(year, term)&#123;</span><br><span class=\"line\">    query &lt;- paste(term, &quot;AND (&quot;, year, &quot;[PDAT])&quot;)</span><br><span class=\"line\">    entrez_search(db=&quot;pubmed&quot;, term=query, retmax=0)$count</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">year &lt;- 2014:2024</span><br><span class=\"line\">papers &lt;- sapply(year, search_year, term=&quot;Drosophila heart[titl]&quot;, USE.NAMES=FALSE)</span><br><span class=\"line\">plot(year, papers, type=&#x27;b&#x27;, main=&quot;The Rise of the Drosophila heart&quot;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"核酸序列-fasta-文件下载\">核酸序列 fasta 文件下载</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 函数 entrez_fetch 获取条目完整信息，常用于下载数据，如选择 nucleotide 数据库并返回类型为 fasta 时可以下载对应 fasta信息，返回为字符串写入到文件，即完成了核酸序列 fasta 文件下载。</span><br><span class=\"line\">el &lt;- entrez_link(dbfrom = &quot;taxonomy&quot;, id = &quot;28285&quot;, db = &quot;nucleotide&quot;)</span><br><span class=\"line\">nu5 &lt;- el$links$taxonomy_nuccore[1:5]</span><br><span class=\"line\">nu5</span><br><span class=\"line\"></span><br><span class=\"line\">ef &lt;- entrez_fetch(db = &quot;nucleotide&quot;, id = nu5, rettype = &quot;fasta&quot;)</span><br><span class=\"line\">temp &lt;- tempfile()</span><br><span class=\"line\">write(ef, temp)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"下载果蝇atg8a蛋白的数据\">下载果蝇atg8a蛋白的数据</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">all_the_links &lt;- entrez_link(dbfrom=&#x27;gene&#x27;, id=32001, db=&#x27;all&#x27;)</span><br><span class=\"line\">all_the_links$links</span><br><span class=\"line\">all_the_links$links$gene_protein</span><br><span class=\"line\"></span><br><span class=\"line\">nuc_links &lt;- entrez_link(dbfrom=&#x27;gene&#x27;, id=32001, db=&#x27;protein&#x27;)</span><br><span class=\"line\">nuc_links</span><br><span class=\"line\">nuc_links$links</span><br><span class=\"line\">nuc_links$links$gene_protein_refseq</span><br><span class=\"line\">ef &lt;- entrez_fetch(db = &quot;protein&quot;, id = 24641085, rettype = &quot;fasta&quot;)</span><br><span class=\"line\">write(ef, &#x27;dm_pro_24641085.fasta&#x27;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\">参考</h2>\n<ol>\n<li class=\"lvl-3\">\n<p>Drost HG, Paszkowski J. <strong>Biomartr: genomic data retrieval with R</strong>. <em>Bioinformatics</em> (2017) 33(8): 1216-1217. <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hY2FkZW1pYy5vdXAuY29tL2Jpb2luZm9ybWF0aWNzL2FydGljbGUvZG9pLzEwLjEwOTMvYmlvaW5mb3JtYXRpY3MvYnR3ODIxLzI5MzE4MTYvQmlvbWFydHItZ2Vub21pYy1kYXRhLXJldHJpZXZhbC13aXRoLVI=\">doi:10.1093/bioinformatics/btw821IF: 5.8 Q1 <i class=\"fa fa-external-link-alt\"></i></span>.</p>\n</li>\n<li class=\"lvl-3\">\n<p>R语言批量爬取NCBI基因注释数据 - 简书 (<span class=\"exturl\" data-url=\"aHR0cDovL2ppYW5zaHUuY29t\">jianshu.com<i class=\"fa fa-external-link-alt\"></i></span>)</p>\n</li>\n<li class=\"lvl-3\">\n<p>关于r：Rcurl：如果url存在，则url.exists返回false | 码农家园 (<span class=\"exturl\" data-url=\"aHR0cDovL2NvZGVub25nLmNvbQ==\">codenong.com<i class=\"fa fa-external-link-alt\"></i></span>)</p>\n</li>\n<li class=\"lvl-3\">\n<p>R语言biomaRt工具包学习笔记 - 知乎 (<span class=\"exturl\" data-url=\"aHR0cDovL3poaWh1LmNvbQ==\">zhihu.com<i class=\"fa fa-external-link-alt\"></i></span>)</p>\n</li>\n<li class=\"lvl-3\">\n<p>BiomaRt 包进行基因ID转换_biomart包id转化方法-CSDN博客</p>\n</li>\n<li class=\"lvl-3\">\n<p>rentrez 获取 NCBI 数据库数据 - 简书 (<span class=\"exturl\" data-url=\"aHR0cDovL2ppYW5zaHUuY29t\">jianshu.com<i class=\"fa fa-external-link-alt\"></i></span>)</p>\n</li>\n</ol>","categories":[{"name":"原创","path":"api/categories/原创.json"},{"name":"科研","path":"api/categories/科研.json"}],"tags":[{"name":"R语言","path":"api/tags/R语言.json"},{"name":"多重序列比对","path":"api/tags/多重序列比对.json"},{"name":"检索","path":"api/tags/检索.json"},{"name":"NCBI","path":"api/tags/NCBI.json"},{"name":"EMBL-EBI","path":"api/tags/EMBL-EBI.json"},{"name":"数据库","path":"api/tags/数据库.json"},{"name":"biomaRt包","path":"api/tags/biomaRt包.json"},{"name":"Biomartr包","path":"api/tags/Biomartr包.json"},{"name":"rentrez包","path":"api/tags/rentrez包.json"}]}