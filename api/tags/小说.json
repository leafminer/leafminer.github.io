{"name":"小说","postlist":[{"title":"R语言--爬取小说-战略级天使","slug":"爬取小说--战略级天使","date":"2021-05-03T16:00:00.000Z","updated":"2024-10-18T19:35:20.227Z","comments":true,"path":"api/articles/爬取小说--战略级天使.json","excerpt":null,"keywords":"Hexo, 科研, 生物, R语言, 爬虫, 生信, 中药, 果蝇, 笔记, 教程, 虫子, 潜叶虫, leafminer, leaf-miner, 生活, 随笔, 原创","cover":null,"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><div id=\"vip-container\"><h2 id=\"目的\">目的</h2>\n<p>小说离线阅读,保存。练习R语言。示例网站：https://www.-----.com/yuedu/15111/</p>\n<span id=\"more\"></span> \n<h2 id=\"实例\">实例</h2>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;stringr&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&quot;rvest&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&#x27;RCurl&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&#x27;curl&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&#x27;downloader&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">library<span class=\"punctuation\">(</span><span class=\"string\">&#x27;RSelenium&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">setwd<span class=\"punctuation\">(</span><span class=\"string\">&#x27;H:\\\\R\\\\R脚本\\\\爬虫&#x27;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">url <span class=\"operator\">&lt;-</span> <span class=\"string\">&quot;https://www.-----.com/yuedu/15111/&quot;</span></span><br><span class=\"line\">htmlpage <span class=\"operator\">&lt;-</span> read_html<span class=\"punctuation\">(</span>url<span class=\"punctuation\">)</span></span><br><span class=\"line\">xs_chapter <span class=\"operator\">&lt;-</span> htmlpage <span class=\"operator\">%&gt;%</span> html_nodes<span class=\"punctuation\">(</span><span class=\"string\">&#x27;div#wrapper div.box_con div#list dl dd a&#x27;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> html_text<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">head<span class=\"punctuation\">(</span>xs_chapter<span class=\"punctuation\">)</span><span class=\"comment\">#观察数据形式</span></span><br><span class=\"line\">xs_link <span class=\"operator\">&lt;-</span> htmlpage <span class=\"operator\">%&gt;%</span> html_nodes<span class=\"punctuation\">(</span><span class=\"string\">&#x27;div#wrapper div.box_con div#list dl dd a&#x27;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> html_attrs<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">head<span class=\"punctuation\">(</span>xs_link<span class=\"punctuation\">)</span><span class=\"comment\">#观察数据形式</span></span><br><span class=\"line\">xs_link <span class=\"operator\">&lt;-</span> paste<span class=\"punctuation\">(</span><span class=\"string\">&quot;https://www.-----.com&quot;</span><span class=\"punctuation\">,</span>unlist<span class=\"punctuation\">(</span>xs_link<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span>sep <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span><span class=\"punctuation\">)</span><span class=\"comment\">#构建章节链接</span></span><br><span class=\"line\">xs_content <span class=\"operator\">&lt;-</span> cbind<span class=\"punctuation\">(</span>xs_chapter<span class=\"punctuation\">[</span><span class=\"operator\">-</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">10</span><span class=\"punctuation\">)</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>xs_link<span class=\"punctuation\">[</span><span class=\"operator\">-</span><span class=\"punctuation\">(</span><span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"number\">10</span><span class=\"punctuation\">)</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span><span class=\"comment\">#合并目录链接</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#尝试获取小说内容，并提取。</span></span><br><span class=\"line\">ms_f1 <span class=\"operator\">&lt;-</span> read_html<span class=\"punctuation\">(</span>xs_content<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">,</span><span class=\"number\">2</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span> encoding <span class=\"operator\">=</span> <span class=\"string\">&quot;GB18030&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> html_nodes<span class=\"punctuation\">(</span><span class=\"string\">&#x27;div#content&#x27;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> html_text<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ms_f2 <span class=\"operator\">&lt;-</span> read_html<span class=\"punctuation\">(</span>xs_content<span class=\"punctuation\">[</span><span class=\"number\">2</span><span class=\"punctuation\">,</span><span class=\"number\">2</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span> encoding <span class=\"operator\">=</span> <span class=\"string\">&quot;GB18030&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> html_nodes<span class=\"punctuation\">(</span><span class=\"string\">&#x27;div#content&#x27;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> html_text<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">ms_f <span class=\"operator\">&lt;-</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span>xs_content<span class=\"punctuation\">[</span><span class=\"number\">1</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>ms_f1<span class=\"punctuation\">,</span>xs_content<span class=\"punctuation\">[</span><span class=\"number\">2</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span>ms_f2<span class=\"punctuation\">)</span></span><br><span class=\"line\">write<span class=\"punctuation\">(</span>gsub<span class=\"punctuation\">(</span><span class=\"string\">&quot;\\u00A0&quot;</span><span class=\"punctuation\">,</span><span class=\"string\">&quot; &quot;</span><span class=\"punctuation\">,</span> ms_f<span class=\"punctuation\">)</span><span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> <span class=\"string\">&quot;1.txt&quot;</span><span class=\"punctuation\">)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#自定义下载函数</span></span><br><span class=\"line\">xs_down <span class=\"operator\">&lt;-</span> <span class=\"keyword\">function</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">)</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  xs <span class=\"operator\">&lt;-</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> <span class=\"punctuation\">(</span>i <span class=\"keyword\">in</span> <span class=\"number\">1</span><span class=\"operator\">:</span><span class=\"built_in\">length</span><span class=\"punctuation\">(</span>x<span class=\"punctuation\">[</span><span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span><span class=\"punctuation\">)</span><span class=\"punctuation\">)</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  xm <span class=\"operator\">&lt;-</span> read_html<span class=\"punctuation\">(</span>x<span class=\"punctuation\">[</span>i<span class=\"punctuation\">,</span><span class=\"number\">2</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span> encoding <span class=\"operator\">=</span> <span class=\"string\">&quot;GB18030&quot;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> html_nodes<span class=\"punctuation\">(</span><span class=\"string\">&#x27;div#content&#x27;</span><span class=\"punctuation\">)</span> <span class=\"operator\">%&gt;%</span> html_text<span class=\"punctuation\">(</span><span class=\"punctuation\">)</span></span><br><span class=\"line\">  xs <span class=\"operator\">&lt;-</span> <span class=\"built_in\">c</span><span class=\"punctuation\">(</span>xs<span class=\"punctuation\">,</span> x<span class=\"punctuation\">[</span>i<span class=\"punctuation\">,</span><span class=\"number\">1</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span> xm<span class=\"punctuation\">)</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  xs</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"comment\">#导出小说</span></span><br><span class=\"line\">write<span class=\"punctuation\">(</span>gsub<span class=\"punctuation\">(</span><span class=\"string\">&quot;\\u00A0&quot;</span><span class=\"punctuation\">,</span><span class=\"string\">&quot; &quot;</span><span class=\"punctuation\">,</span> xs_down<span class=\"punctuation\">(</span>xs_content<span class=\"punctuation\">)</span><span class=\"punctuation\">)</span><span class=\"punctuation\">,</span>file <span class=\"operator\">=</span> <span class=\"string\">&quot;战略级天使.txt&quot;</span><span class=\"punctuation\">)</span></span><br></pre></td></tr></table></figure></div>\n\n\t\t\t<script src=\"https://my.openwrite.cn/js/readmore.js\" type=\"text/javascript\"></script>\n\t\t\t<script>\n\t\t\tvar isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);\n\t\t\tif (!isMobile) {\n\t\t\t    var btw = new BTWPlugin();\n\t\t\t    btw.init({\n\t\t\t        \"id\": \"vip-container\",\n\t\t\t        \"blogId\": \"33502-1730425843713-524\",\n\t\t\t        \"name\": \"虫子的生存笔记\",\n\t\t\t        \"qrcode\": \"https://leaf-miner.pages.dev/image/%E5%85%AC%E4%BC%97%E5%8F%B7.png\",\n\t\t\t        \"keyword\": \"more\"\n\t\t\t    });\n\t\t\t}\n\t\t\t</script>\n\t\t","raw":null,"categories":[{"name":"原创","path":"api/categories/原创.json"},{"name":"原创/其他","path":"api/categories/原创/其他.json"}],"tags":[{"name":"R语言","path":"api/tags/R语言.json"},{"name":"实例","path":"api/tags/实例.json"},{"name":"爬虫","path":"api/tags/爬虫.json"},{"name":"小说","path":"api/tags/小说.json"}]}]}